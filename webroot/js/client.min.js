var surveyInvitationForm={counter:1,already_invited:[],uninvited_respondents:[],init:function(e){this.counter=e.counter,this.already_invited=e.already_invited,this.uninvited_respondents=e.uninvited_respondents,this.addRow(!1),$("#add_another").click(function(e){e.preventDefault(),surveyInvitationForm.addRow(!0)}),$("#sent_invitations_toggler").click(function(e){e.preventDefault(),$("#sent_invitations").slideToggle()}),$("#suggestions_toggler").click(function(e){e.preventDefault(),$("#invitation_suggestions").slideToggle()}),$("#UserClientInviteForm").submit(function(e){var n=$(this);return n.find(".already_invited").length>0?(alert("Please remove any email addresses that have already been recorded before continuing."),e.preventDefault(),!1):!0})},addRow:function(e){var n=$("#invitation_fields_template"),t=n.clone();t.attr("id",""),t.find("input[type=email], input[type=text]").each(function(){var e=$(this);e.prop("disabled",!1),e.attr("id",""),e.change(function(){var e=$(this),n=e.val().trim();e.val(n),"email"==e.attr("type")&&surveyInvitationForm.checkEmail(e)});var n=e.attr("name").replace("0",this.counter);e.attr("name",n)}),t.find("button.remove").click(function(){$(this).parent("div").slideUp(function(){$(this).remove()})}),this.counter++,$("#UserClientInviteForm fieldset").append(t),e?t.slideDown():t.show()},checkEmail:function(e){var n=e.val();if(""!==n){var t=e.closest(".form-inline");t.children(".error-message").remove();var i=null;this.isInvitedRespondent(n)?(i=$('<div class="error-message already_invited">An invitation has already been sent to '+n+"</div>"),t.append(i)):(i=e.parent("div").children(".error-message"),i.removeClass("already_invited"),i.slideUp(function(){$(this).remove()}))}},isInvitedRespondent:function(e){return-1!=this.already_invited.indexOf(e)},isUninvitedRespondent:function(e){return-1!=this.uninvited_respondents.indexOf(e)}},clientHome={init:function(){this.setupImport(),$(".importing_note_toggler").click(function(e){e.preventDefault();var n=$(this).closest("td").find(".importing_note");n.slideToggle()})},setupImport:function(){$(".import_button").click(function(e){e.preventDefault();var n=$(this);if(!n.hasClass("disabled")){var t=n.data("survey-id"),i=n.closest("tr");$.ajax({url:"/surveys/import/"+t,beforeSend:function(){n.addClass("disabled");var e=$('<img src="/data_center/img/loading_small.gif" class="loading" />');n.append(e)},success:function(e){var n=$('<p class="last_import alert alert-success" role="alert">'+e+"</p>");n.hide(),i.find(".last_import").slideUp(function(){$(this).remove()});var t=i.children("td:nth-child(2)");t.append(n),n.slideDown()},error:function(e,n,t){console.log(e),console.log(n),console.log(t);var s=$('<p class="last_import alert alert-danger" role="alert">There was an error checking for new responses.<br />Please try again or contact us for assistance.</p>');s.hide(),i.find(".last_import").slideUp(function(){$(this).remove()});var a=i.children("td:nth-child(2)");a.append(s),s.slideDown()},complete:function(){n.removeClass("disabled"),n.find(".loading").remove()}})}})}},unapprovedRespondents={init:function(){$("#toggle_dismissed").click(function(e){e.preventDefault(),$("#dismissed_respondents > div").slideToggle()}),$("a.approve, a.dismiss").click(function(e){e.preventDefault();var n=$(this);unapprovedRespondents.updateRespondent(n)})},updateRespondent:function(e){$.ajax({url:e.attr("href"),beforeSend:function(){e.addClass("disabled");var n=$('<img src="/data_center/img/loading_small.gif" class="loading" />');e.append(n),e.closest("td").find("p.text-danger, p.text-success, p.text-warning").slideUp()},success:function(n){var t=null;"success"==n?(e.hasClass("dismiss")?(t=$('<p class="text-warning">Dismissed</p>'),e.closest("tr").addClass("bg-warning")):(t=$('<p class="text-success">Approved</p>'),e.closest("tr").addClass("bg-success")),t.hide(),e.closest("td").append(t),e.closest("span.actions").slideUp(300,function(){t.slideDown()})):(t=$('<p class="text-danger">Error</p>'),e.closest("td").append(t))},error:function(e,n,t){console.log(e),console.log(n),console.log(t),alert("There was an error updating this respondent's status. Please try again or contact us for assistance.")},complete:function(){e.find(".loading").remove(),e.parent().children("a").removeClass("disabled")}})}};